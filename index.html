<!DOCTYPE html>
<html>

<head>
  <title>My experiment</title>
  <script src="https://unpkg.com/jspsych@8.0.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-image-keyboard-response@2.0.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@2.0.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-html-button-response@2.0.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-fullscreen@1.2.1"></script>
  <script src="https://unpkg.com/@jspsych/plugin-survey-text@2.0.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-image-slider-response@2.0.0"></script>
  <link href="https://unpkg.com/jspsych@8.0.0/css/jspsych.css" rel="stylesheet" type="text/css" />
</head>

<body></body>
<script>

  /* initialize jsPsych */
  var jsPsych = initJsPsych({
    on_finish: function () {
      jsPsych.data.displayData();
    }
  });

  /* create timeline */
  var timeline = [];

  /**
   * enable fullscreen
   */
  timeline.push({
    type: jsPsychFullscreen,
    fullscreen_mode: true
  });

  //Create a random ID for the participant
  var participant_id = jsPsych.randomization.randomID();
  jsPsych.data.addProperties({
    participant: participant_id
  });
  console.log("Generated Participant ID:", participant_id);

  // define welcome message trial
  var welcome = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: "Welcome to the experiment. Press any key to continue."
  };

  timeline.push(welcome);

  var instructions = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: `
    <p>You will be shown X images in a series</p>
    <p>After you see all the images, you will be shown pairs of images.</p>
    <p>Select the image you think you saw during the intial stream of images</p>
    <p>After each choice, you'll rate your confidence in your decision</p>
    <p>Press any key to begin.</p>
    `
  };

  timeline.push(instructions);

  /* create memory list */
  var memory_list = [
    "stimuli/STATE/USED/Sabacus1.jpg",
    "stimuli/STATE/USED/Sbabytoy1.JPG",
    "stimuli/STATE/USED/Sbagel1.JPG",
    "stimuli/EXEMPLAR/USED/Ebasket1.jpg",
    "stimuli/EXEMPLAR/USED/Ebell1.jpg",
    "stimuli/EXEMPLAR/USED/Ebicycle1.jpg"
  ]
  var memory_list_shuffled = jsPsych.randomization.shuffle(memory_list);
  console.log(memory_list_shuffled)

  /* create test stimulus list */
  var test_list = [
    {
      item_1: "Sabacus1.jpg",
      item_2: "Sabacus2.jpg",
      test_type: "state",
      path_to_image: "stimuli/STATE/USED/"
    },
    {
      item_1: "Sbabytoy1.JPG",
      item_2: "Sbabytoy2.JPG",
      test_type: "state",
      path_to_image: "stimuli/STATE/USED/"
    },
    {
      item_1: "Sbagel1.JPG",
      item_2: "Sbagel2.jpg",
      test_type: "state",
      path_to_image: "stimuli/STATE/USED/"
    },
    {
      item_1: "Ebasket1.jpg",
      item_2: "Ebasket2.jpg",
      test_type: "exemplar",
      path_to_image: "stimuli/EXEMPLAR/USED/"
    },
    {
      item_1: "Ebell1.jpg",
      item_2: "Ebell2.jpg",
      test_type: "exemplar",
      path_to_image: "stimuli/EXEMPLAR/USED/"
    },
    {
      item_1: "Ebicycle1.jpg",
      item_2: "Ebicycle2.jpg",
      test_type: "exemplar",
      path_to_image: "stimuli/EXEMPLAR/USED/"
    }
  ];
  var test_list_shuffled = jsPsych.randomization.shuffle(test_list);
  console.log(test_list_shuffled)

  //cycle through memory list
  for (i = 0; i < memory_list_shuffled.length; i++) {
    var current_image = memory_list_shuffled[i];

    var fixation = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: '<div style="font-size:60px;">+</div>',
      choices: "NO_KEYS",
      trial_duration: 1000,
    };

    timeline.push(fixation);

    var trial = {
      type: jsPsychImageKeyboardResponse,
      stimulus: current_image,
      choices: [" "],
      trial_duration: 3000,
      response_ends_trial: false,
      data: {
        trial_phase: "memory"
      }
    }
    timeline.push(trial);
  }

  //cycle through test list
  for (let i = 0; i < test_list_shuffled.length; i++) {
    var current_item = test_list_shuffled[i];
    var image_1 = current_item["path_to_image"] + current_item["item_1"];
    var image_2 = current_item["path_to_image"] + current_item["item_2"];
    var shuffledImages = jsPsych.randomization.shuffle([image_1, image_2]);

    // Test trial with shuffled images
    var test_trial = {
      type: jsPsychHtmlButtonResponse,
      stimulus: "Which of these items did you see before?",
      choices: [
        `<img src="${shuffledImages[0]}" style="width:200px;height:200px;">`,
        `<img src="${shuffledImages[1]}" style="width:200px;height:200px;">`
      ],
      data: {
        choice_images: shuffledImages,
        correct_image: image_1
      },
      on_finish: function (data) {
        data.choice = data.choice_images[data.response];
        data.correct = data.choice === data.correct_image;
      }
    };

    //confidence slider created, will display after the participant chooses one of the images.
    //selected Image will be displayed above the slider
    var confidence_rating = {
      type: jsPsychImageSliderResponse,
      stimulus: function () {
        var last_trial = jsPsych.data.get().last(1).values()[0];
        return last_trial.choice;
      },
      labels: ['1<br>Not at all confident', '2', '3', '4', '5<br>Very confident'],
      slider_width: 500,
      min: 1,
      max: 5,
      slider_start: 3,
      step: 1,
      prompt: "<p>How confident are you in your choice?</p>",
      require_movement: true,
      data: {
        task: 'confidence_rating'
      }
    };

    var trial_procedure = {
      timeline: [test_trial, confidence_rating]
    };

    timeline.push(trial_procedure);
  }

  // Post-experiment survey
  var post_experiment_survey = {
    type: jsPsychSurveyText,
    questions: [
      {
        prompt: "What details did you use to distinguish the items? Please describe.",
        placeholder: "Type your response here...",
        rows: 5,
        columns: 50
      }
    ],
    preamble: "<h3>Post-Experiment Survey</h3><p>Please answer the following questions about your experience during the experiment.</p>",
    button_label: "Submit"
  };

  timeline.push(post_experiment_survey);

  var end_experiment = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: "The experiment has ended, press any key to exit. Goodbye!"
  };
  timeline.push(end_experiment);

  // Disable full screen 
  timeline.push({
    type: jsPsychFullscreen,
    fullscreen_mode: false
  });

  /* start the experiment */
  jsPsych.run(timeline);

</script>

</html>